Partial refactor towards 1512