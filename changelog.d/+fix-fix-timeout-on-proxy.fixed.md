Update the code to reimplement the fix but without moving the pinging source.
