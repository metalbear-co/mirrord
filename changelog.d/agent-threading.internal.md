Reworked agent's threading model to avoid spawning excessive threads.
